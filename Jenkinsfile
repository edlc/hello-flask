pipeline {
	agent any
	stages {
		stage ('Build') {
			steps {
				sh '''
					 make install
					 ./run_docker.sh 
				'''
				}
		}
		stage ('Lint'){
			steps{
				sh '''
					./hadolint Dockerfile		
					make lint
				'''
			}
		}
		stage ('Upload Docker Image'){
			steps{
				sh ' ./upload_docker.sh'
			}
		}
		stage ('Deploy'){
		      withKubeConfig([credentialsId: 'jenkins-master',caCertificate: 'LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJd01UQXhOVEEzTlRVeU5sb1hEVE13TVRBeE16QTNOVFV5Tmxvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBT09HCjVWSFUwK1dyT1hGWE40bGE4VFRnUVV4cjNhN0xvWUNRRE4xWkZtcVlvZnhiUHVvcWl1R3prV3NSQVAzdVBNL1QKS2dlRzhRK1ZUZXQ0YzE2RDZiai94MzhsRjRQbWFvOVA2MDhjMlRjbks5ajA5U0VUQ1A1ck1jR3FBc1FKaWZlUQp4dGpDbFFqVjZqNUF6ZW1yU3J5ZHg3Qkt5dDc3Qis0TjFTWEEzeFp5V2hBektBRmFSdHpnN1FTdmliQVFmd2JCCnE0cnlaWjBMQ0pRQ0tGQnM4QTJEZkkxSWxQcHMwaE5HekxYV2tCY3BnNzQzaWpXc2dCUC9JTnlZVG1KYzQ4dHoKUkJnYklteEtqa0I3Sjhib0VwQ0JIb0ZwK2hCWG1wNFlOQ0l1VDgzWGdyOC9jV01qY3RnVmsxT1FrbmZpZzJRMQp1RkVaWFNmVTZpMmRYTG80M0ZzQ0F3RUFBYU1qTUNFd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFBN3VJS05kTEJmNGUvQ2xSRG5ITnZUdy9rVVoKTVpWVkJSZFFZQmlwdVdWbjltOUxYTEd5SEZjTjZUZ0lpWWtjWG0wWUFReGhRVDVUNkc3V1pqTENPQlBWVVU3aApPQllmOXhMV2Vnc0NXNTd0bnJpNTJOQ0RZR3ZZbHk1KzdqbGFiNFhzNkxmZ1VlQjhXeFc4Ky9iRHM2N3c4VmRWCmJuVUd6TjVCQ1RjMmdhbytGY09lUjZqdUxBWUsrRmo0VXlhVzgyQkxJNkRxMXZobHA5NXNlQjRpcEhUeDk0bTAKN0QvVzQrNzVrM1ZEdy9lYlpnL1pxV1YwZE0wempJaS8vUFpIQU0xTERhN3Zpd2labGYvOFVXMkttMzZkcXFlWgpFVENXVlNjSzlUdTU0KzZ6djlWVFM0RlhWekVDZ0FMTDc2M1FaMXNwK2dmQlV5MldLdFNDVS80N2pBWT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=',serverUrl: 'https://BB1B07604EC6D9AAB16ABB56758FC456.gr7.ap-southeast-2.eks.amazonaws.com
',,clusterName: 'eksCluster',namespace: 'hello-flask']) {
				sh '''
				 	kubectl get svc
		 		'''
		      }
		}
	}
}
